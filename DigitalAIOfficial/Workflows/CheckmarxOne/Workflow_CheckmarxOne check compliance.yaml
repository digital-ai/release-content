---
apiVersion: xl-release/v1
kind: Templates
metadata:
  path: Workflows/CheckmarxOne
  home: Digital.ai - Official/Workflows/CheckmarxOne
spec:
  - template: CheckmarxOne check compliance
    description: CheckmarxOne check compliance triggers a scan on Git repository and
      then automates code assessment using SAST and SCA  to detect security flaws and
      vulnerabilities in the code.
    scheduledStartDate: 2024-08-30T09:00:00+05:30
    dueDate: 2024-08-30T10:00:00+05:30
    phases:
      - phase: Trigger Git scan
        tasks:
          - name: Server Configuration
            type: xlrelease.UserInputTask
            description: "Select the CheckmarxOne connection, or create a new one if it\
        \ doesn't exist."
            variables:
              - checkmarxOneServer
          - name: Repository Configuration
            type: xlrelease.UserInputTask
            description: Specify the Git repository to scan.
            variables:
              - gitUrl
              - branch
              - gitUsername
              - gitPassword
              - gitToken
          - name: Scan Configuration
            type: xlrelease.UserInputTask
            description: Configure the CheckmarxOne scan.
            variables:
              - projectName
              - preset
              - startSASTScan
              - startSCAScan
              - skipSubModule
              - waitInterval
              - scanTags
              - projectTags
          - name: Trigger Scan
            type: checkmarxOne.gitScan
            projectName: "${projectName}"
            sastPreset: "${preset}"
            gitUrl: "${gitUrl}"
            branch: "${branch}"
            username: "${gitUsername}"
            description: Initiates a scan on the specified Git repository.
            variableMapping:
              pythonScript.startSCAScan: "${startSCAScan}"
              pythonScript.scanId: "${scanId}"
              pythonScript.project_tags: "${projectTags}"
              pythonScript.timeThreshold: "${waitInterval}"
              pythonScript.token: "${gitToken}"
              pythonScript.scan_tags: "${scanTags}"
              pythonScript.password: "${gitPassword}"
              pythonScript.checkmarxOneServer: "${checkmarxOneServer}"
              pythonScript.skipSubModule: "${skipSubModule}"
              pythonScript.startSASTScan: "${startSASTScan}"
        color: '#3d6c9e'
      - phase: SAST - Check Compliance
        tasks:
          - name: SAST - Severity Threshold
            type: xlrelease.UserInputTask
            description: Please enter the thresholds for vulnerability categories. The compliance
              fails when the if actual values exceeds the defined thresholds.
            precondition: |-
              import json
              if releaseVariables['startSASTScan'] != False:
                result = True
              elif releaseVariables['startSCAScan'] != False:
                result = False
            variables:
              - sastHigh
              - sastMedium
              - sastLow
          - name: SAST - Check Compliance
            type: checkmarxOne.checkSastCompliance
            projectName: "${projectName}"
            scanId: "${scanId}"
            description: SAST - Check Compliance verifies that the project vulnerabilities
              do not exceed the defined thresholds.
            precondition: |-
              import json
              if releaseVariables['startSASTScan'] != False:
                result = True
              elif releaseVariables['startSCAScan'] != False:
                result = False
            variableMapping:
              pythonScript.securityRiskMediumThreshold: "${sastMedium}"
              pythonScript.securityRiskHighThreshold: "${sastHigh}"
              pythonScript.securityRiskLowThreshold: "${sastLow}"
              pythonScript.checkmarxOneServer: "${checkmarxOneServer}"
        color: '#3d6c9e'
      - phase: SCA - Check Compliance
        tasks:
          - name: SCA - Severity Threshold
            type: xlrelease.UserInputTask
            description: Please enter the thresholds for vulnerability categories. The compliance
              fails when the if actual values exceeds the defined thresholds.
            precondition: |-
              import json
              if releaseVariables['startSCAScan'] != False:
                result = True
              elif releaseVariable['startSASTScan'] != False:
                result = False
            variables:
              - scaHigh
              - scaMedium
              - scaLow
          - name: SCA - Check Compliance
            type: checkmarxOne.checkScaCompliance
            checkmarxOneServer: "CheckmarxOne: Server"
            projectName: "${projectName}"
            scanId: "${scanId}"
            description: SCA - Check Compliance verifies that the project vulnerabilities
              do not exceed the defined thresholds.
            precondition: |-
              import json
              if releaseVariables['startSCAScan'] != False:
                result = True
              elif releaseVariable['startSASTScan'] != False:
                result = False
            variableMapping:
              pythonScript.securityRiskMediumThreshold: "${scaMedium}"
              pythonScript.securityRiskHighThreshold: "${scaHigh}"
              pythonScript.securityRiskLowThreshold: "${scaLow}"
        color: '#3d6c9e'
    kind: WORKFLOW
    categories:
      - Application Life Cycle Management
    variables:
      - type: xlrelease.ReferenceVariable
        key: checkmarxOneServer
        showOnReleaseStart: false
        label: "CheckmarxOne: Server"
        description: "CheckmarxOne: Server Connection"
        referencedType: checkmarxOne.Server
      - type: xlrelease.StringVariable
        key: gitUrl
        showOnReleaseStart: false
        label: Git URL
        description: Git repository URL
      - type: xlrelease.StringVariable
        key: branch
        showOnReleaseStart: false
        label: Branch
        description: "Git branch, e.g. master or main"
      - type: xlrelease.StringVariable
        key: gitUsername
        requiresValue: false
        showOnReleaseStart: false
        label: Username
        description: Username for Git access
      - type: xlrelease.PasswordStringVariable
        key: gitPassword
        requiresValue: false
        showOnReleaseStart: false
        label: Password
        description: Password for Git access
      - type: xlrelease.PasswordStringVariable
        key: gitToken
        requiresValue: false
        showOnReleaseStart: false
        label: Token
        description: Personal token for Git access
      - type: xlrelease.BooleanVariable
        key: startSASTScan
        requiresValue: false
        showOnReleaseStart: false
        label: SAST Scan
        description: Indicates whether to run a SAST scan.
        value: true
      - type: xlrelease.BooleanVariable
        key: startSCAScan
        requiresValue: false
        showOnReleaseStart: false
        label: SCA Scan
        description: Indicates whether to run a SCA scan.
        value: true
      - type: xlrelease.BooleanVariable
        key: skipSubModule
        requiresValue: false
        showOnReleaseStart: false
        label: Skip Submodule
        description: Indicates whether to skip scanning Git submodules.
      - type: xlrelease.IntegerVariable
        key: waitInterval
        showOnReleaseStart: false
        label: Wait Interval
        description: Time interval between status checks (in minutes).
        value: 30
      - type: xlrelease.MapStringStringVariable
        key: scanTags
        requiresValue: false
        showOnReleaseStart: false
        label: Scan Tags
        description: A list of the key-value tags associated with the scan.
      - type: xlrelease.MapStringStringVariable
        key: projectTags
        requiresValue: false
        showOnReleaseStart: false
        label: Project Tags
        description: "A list of the key-value tags, that will overwrite the tags in current\
      \ project."
      - type: xlrelease.StringVariable
        key: projectName
        showOnReleaseStart: false
        label: Project Name
        description: CheckmarxOne project name.
      - type: xlrelease.StringVariable
        key: preset
        requiresValue: false
        showOnReleaseStart: false
        label: Preset
        description: "CheckmarxOne SAST preset, e.g., ASA Premium."
        value: ASA Premium
      - type: xlrelease.StringVariable
        key: scanId
        requiresValue: false
        showOnReleaseStart: false
        label: Scan ID
        description: ID of the scan to retrieve results for.
      - type: xlrelease.IntegerVariable
        key: sastHigh
        showOnReleaseStart: false
        label: High
        description: High severity threshold.
      - type: xlrelease.IntegerVariable
        key: sastMedium
        showOnReleaseStart: false
        label: Medium
        description: Medium severity threshold.
      - type: xlrelease.IntegerVariable
        key: sastLow
        showOnReleaseStart: false
        label: Low
        description: Low severity threshold.
      - type: xlrelease.IntegerVariable
        key: scaHigh
        showOnReleaseStart: false
        label: High
        description: High severity threshold.
      - type: xlrelease.IntegerVariable
        key: scaMedium
        showOnReleaseStart: false
        label: Medium
        description: Medium severity threshold.
      - type: xlrelease.IntegerVariable
        key: scaLow
        showOnReleaseStart: false
        label: Low
        description: Low severiy threshold.
    disableNotifications: true
    author: Digital.ai
    logo:
      type: xlrelease.TemplateLogo
      contentType: image/svg+xml
      file: !file "template-logo/a729696e87b10f1b1533e5ec5ddee2e952052114/cxlogo.svg"
    defaultTargetFolder: Digital.ai - Official/Workflow Executions
